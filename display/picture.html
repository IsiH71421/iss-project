<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>NASA Picture of the Day</title>
  <link rel="stylesheet" href="../assets/css/style.css" />
</head>

<body>
  <h1 id="headline">NASA Picture of the Day</h1>
  <p id="date"></p>
  <h2 id="title"></h2>
  <img id="picture" width="600" />
  <p id="explanation"></p>

  <div class="qr-code-option-container">
    <div class="qr-code-option">
      <span class="emoji">ðŸ“…</span> Get picture of the day before
      <img src="../assets/qr_picture_day_before.png" alt="Back QR" class="qr-code">
    </div>

    <div class="qr-code-option" id="qr-next-day" style="display:none;">
      <span class="emoji">ðŸ“…</span> Get picture of the next day
      <img src="../assets/qr_picture_day_after.png" alt="Forward QR" class="qr-code">
    </div>

    <div class="qr-code-option">
      <span class="emoji">â¬…</span> Back to Countdown
      <img src="../assets/qr_index.png" alt="Back QR" class="qr-code">
    </div>
  </div>

  <script>
    function getParameterByName(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }

    const goXDaysBack = parseInt(getParameterByName('go_x_days_back')) || 0;
    const pictureQueryString = getParameterByName('params');

    const headlineEl = document.getElementById('headline');
    const dateEl = document.getElementById('date');
    const titleEl = document.getElementById('title');
    const pictureEl = document.getElementById('picture');
    const explanationEl = document.getElementById('explanation');

    if (goXDaysBack === 0) {
      headlineEl.textContent = 'NASA Picture of the Day';
    } else if (goXDaysBack === 1) {
      headlineEl.textContent = 'NASA Picture from 1 day ago';
    } else {
      headlineEl.textContent = `NASA Picture from ${goXDaysBack} days ago`;
    }

    if (pictureQueryString) {
      try {
        const data = JSON.parse(decodeURIComponent(pictureQueryString));
        pictureEl.src = data.url;
        explanationEl.textContent = data.explanation;
        titleEl.textContent = data.title || '';
        dateEl.textContent = data.date || '';
        pictureEl.style.display = 'block';
      } catch (e) {
        pictureEl.src = '';
        pictureEl.style.display = 'none';
        titleEl.textContent = '';
        dateEl.textContent = '';
        explanationEl.textContent = 'Problem with the given data.';
      }
    } else {
      pictureEl.src = '';
      pictureEl.style.display = 'none';
      titleEl.textContent = '';
      dateEl.textContent = '';
      explanationEl.textContent = 'No data was found.';
    }
  </script>

</body>

</html>
