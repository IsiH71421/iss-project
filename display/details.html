<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>ISS Pass Details</title>
  <link rel="stylesheet" href="../assets/css/style.css" />
  <script src="../assets/js/functions.js"></script>
</head>

<body>
  <div class="main-layout">
    <div class="content">
      <h1>ISS Pass Details</h1>
      <div class="details-container" id="details">
        Loading pass details...
      </div>
    </div>

    <div class="qr-code-option-container">
      <div class="qr-code-option">
        <span class="emoji">⬅</span>
        <span class="text-content">Back to Countdown</span>
        <img src="../assets/qr_index.png" alt="Back QR" class="qr-code">
      </div>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const pass_details = urlParams.get('details');

    function formatTimestamp(utc) {
      const date = new Date(utc * 1000);
      return date.toLocaleString();
    }

    function showDetails(data) {
      const container = document.getElementById('details');
      const visibilityNote = data.visible ? "Yes" : "No";

      container.innerHTML = `
       <div class="detail-item"><strong>Start:</strong> ${formatTimestamp(data.start_timestamp)} (${data.azimuth_start_deg}°, ${data.direction.split("→")[0].trim()})</div>
       <div class="detail-item"><strong>End:</strong> ${formatTimestamp(data.end_timestamp)} (${data.azimuth_end_deg}°, ${data.direction.split("→")[1].trim()})</div>
       <div class="detail-item"><strong>Duration:</strong> ${formatTime(data.duration_sec)}</div>
       <div class="detail-item"><strong>Visible:</strong> ${visibilityNote}</div>
       <div class="detail-item"><strong>Maximum Elevation:</strong> ${data.max_elevation_deg}°</div>
       <div class="detail-item"><strong>Direction:</strong> ${data.direction}</div>
       <div class="detail-item"><strong>Brightness Estimate:</strong> ${data.brightness_estimate}</div>
       <div class="detail-item"><strong>Flight Distance during Pass:</strong> ${data.distance_km.toFixed(1)} km</div>
  `;
    }

    if (pass_details) {
      try {
        const data = JSON.parse(decodeURIComponent(pass_details));
        showDetails(data);
      } catch (e) {
        document.getElementById('details').textContent = "❌ Failed to parse pass data.";
      }
    } else {
      document.getElementById('details').textContent = "❌ No pass data provided.";
    }
  </script>

</body>

</html>
