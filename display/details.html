<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>ISS Pass Details</title>
  <link rel="stylesheet" href="../assets/css/style.css" />
  <script src="../assets/js/functions.js"></script>
</head>

<body>
  <div class="main-layout">
    <div class="content">
      <h1>ISS Pass Details</h1>
      <div class="details-container" id="details">
        Loading pass details...
      </div>
    </div>

    <div class="qr-code-option-container">
      <div class="qr-code-option">
        <span class="emoji">⬅</span>
        <span class="text-content">Back to Countdown</span>
        <img src="../assets/qr_index.png" alt="Back QR" class="qr-code">
      </div>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const pass_details = urlParams.get('details');

    function formatTimestamp(utc) {
      const date = new Date(utc * 1000);
      return date.toLocaleString();
    }

    function showDetails(data) {
      const container = document.getElementById('details');

      // Check if start and visibility start are the same
      const startLabel = data.startVisibility && Math.abs(data.startUTC - data.startVisibility) > 5
        ? "Start:"
        : "Overflight and Visibility Start:";

      const visibilityLine = data.startVisibility && Math.abs(data.startUTC - data.startVisibility) > 5
        ? `<div class="detail-item"><strong>Visibility Start:</strong> ${formatTimestamp(data.startVisibility)}</div>`
        : '';

      container.innerHTML = `
    <h2>Pass Overview</h2>
    <div class="detail-item"><strong>${startLabel}</strong> ${formatTimestamp(data.startUTC)} (${data.startAzCompass}, ${data.startEl}°)</div>
    <div class="detail-item"><strong>Maximum:</strong> ${formatTimestamp(data.maxUTC)} (${data.maxAzCompass}, ${data.maxEl}°)</div>
    <div class="detail-item"><strong>End:</strong> ${formatTimestamp(data.endUTC)} (${data.endAzCompass}, ${data.endEl}°)</div>
    <div class="detail-item"><strong>Magnitude:</strong> ${data.mag}</div>
    <div class="detail-item"><strong>Duration:</strong> ${formatTime(data.duration)}</div>
    ${visibilityLine}
  `;
    }

    if (pass_details) {
      try {
        const data = JSON.parse(decodeURIComponent(pass_details));
        showDetails(data);
      } catch (e) {
        document.getElementById('details').textContent = "❌ Failed to parse pass data.";
      }
    } else {
      document.getElementById('details').textContent = "❌ No pass data provided.";
    }
  </script>

</body>

</html>
